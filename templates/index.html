<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FakeBuster</title>
    
    <!-- Inline script to prevent flash of unstyled content -->
    <script>
        (function() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.documentElement.classList.add('dark-theme');
            } else if (savedTheme === 'light') {
                // Light mode - explicitly ensure no dark theme
                document.documentElement.classList.remove('dark-theme');
            } else {
                // No saved preference - default to dark mode
                document.documentElement.classList.add('dark-theme');
                localStorage.setItem('theme', 'dark');
            }
        })();
    </script>
    
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='favicon.svg') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Theme Toggle Button -->
    <div class="theme-toggle-container">
        <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
            <div class="toggle-track">
                <div class="toggle-thumb">
                    <span class="icon">ðŸŒ™</span>
                </div>
            </div>
        </button>
        <!-- <span class="theme-label" id="themeLabel">Light Mode</span> -->
    </div>
    
    <div class="wrapper">
        <div class="container">
            <h2>FakeBuster: Fake News & Spam Detection</h2>

            <!-- Tabs for Single Text / CSV Upload -->
            <div class="tabs" role="tablist" aria-label="Input mode tabs">
                <button type="button" class="tab {% if active_tab=='single' %}active{% endif %}" data-target="singleTab">Single Text</button>
                <button type="button" class="tab {% if active_tab=='csv' %}active{% endif %}" data-target="csvTab">CSV Upload</button>
            </div>

            <div id="singleTab" class="tab-content {% if active_tab=='single' %}active{% endif %}" {% if active_tab!='single' %}style="display:none;"{% endif %}>
            <form action="/predict" method="post" id="predictionForm">
                <label for="task">Choose Functionality:</label>
                <select name="task" id="task" onchange="updatePlaceholder()">
                    <option value="fake_news" {% if task == "fake_news" %}selected{% endif %}>Fake News Detection</option>
                    <option value="spam" {% if task == "spam" %}selected{% endif %}>Spam Email Detection</option>
                </select>

                <label for="message">Enter your text:</label>
                <textarea name="message" id="message" rows="6" placeholder="Enter news headline or article here...">{{ message or '' }}</textarea>

                <div class="button-group">
                    <button type="submit" id="predictBtn">Predict</button>
                    <button type="button" id="clearBtn" onclick="clearForm()">Clear</button>
                </div>
            </form>

            <!-- Loading Spinner -->
            <div id="loadingSpinner" class="loading-spinner" style="display: none;">
                <div class="spinner"></div>
                <p>Analyzing...</p>
            </div>
            {% if result and 'CSV processed' not in result %}
            <div class="result {{ 'result-real' if 'Real' in result or 'Not Spam' in result or 'Ham' in result else 'result-fake' }}">
                <h3>Prediction Result:</h3>
                <p>{{ result }}</p>
                {% if probability is not none %}
                <div class="probability">
                    <div class="prob-label">Probability {% if task=='fake_news' %}of Fake News{% else %}of Spam{% endif %}: <strong>{{ probability }}%</strong></div>
                    <div class="prob-bar">
                        <div class="prob-fill" style="width: {{ probability }}%;"></div>
                    </div>
                </div>
                {% endif %}
                {% if explanation and ('Fake News' in result or 'Spam Message' in result) %}
                <div class="explanation">
                    <h4>Why this prediction?</h4>
                    <p>{{ explanation }}</p>
                </div>
                {% endif %}
            </div>
            {% endif %}
            </div>

            <!-- CSV Upload / Batch Predictions tab content -->
            <div id="csvTab" class="tab-content {% if active_tab=='csv' %}active{% endif %}" {% if active_tab!='csv' %}style="display:none;"{% endif %}>
                <div class="csv-upload">
                    <form action="/predict_csv" method="post" enctype="multipart/form-data" id="csvForm">
                        <label for="taskCsv">Choose Functionality:</label>
                        <select name="task" id="taskCsv">
                            <option value="fake_news">Fake News Detection</option>
                            <option value="spam">Spam Email Detection</option>
                        </select>

                        <label for="csvFile">Choose CSV file:</label>
                        <input type="file" name="file" id="csvFile" accept=".csv" required>
                        <div class="file-meta"><span id="csvFilename" class="csv-filename">No file chosen</span></div>

                        <div class="button-group">
                            <button type="submit">Upload & Predict</button>
                            <button type="button" id="csvClearBtn" onclick="document.getElementById('csvFile').value = ''; document.getElementById('csvFilename').textContent = 'No file chosen';">Clear</button>
                        </div>
                    </form>
                    {% if csv_preview %}
                    <div class="csv-preview" style="margin-top:14px;">
                        <h4>Preview (first {{ csv_preview|length }} rows)</h4>
                        <div class="preview-table" style="overflow:auto; margin-top:8px;">
                            <table>
                                <thead>
                                    <tr>
                                        {% for col in csv_preview[0].keys() %}
                                        <th>{{ col }}</th>
                                        {% endfor %}
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for row in csv_preview %}
                                    <tr>
                                        {% for v in row.values() %}
                                        <td>{{ v }}</td>
                                        {% endfor %}
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <div style="margin-top:10px; display:flex; gap:10px;">
                            <a class="button" href="{{ url_for('download_predictions') }}">Download CSV with predictions</a>
                            <a class="button" href="{{ url_for('clear_predictions') }}">Clear Preview</a>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

        
    </div>
    
    <footer class="footer">
        <p>Developed by Team FakeBuster | 2025</p>
    </footer>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
